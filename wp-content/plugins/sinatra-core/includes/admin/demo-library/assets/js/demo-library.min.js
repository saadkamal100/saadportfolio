!function($){"use strict";var $body=$("body"),$document=$(document),$html=($("#page"),$("html")),SinatraCoreDemoLibrary={import_start_time:"",install_plugins:[],installed_plugins:[],progress:0,import_steps:[],completed_steps:[],init:function(){$(document).ready(SinatraCoreDemoLibrary.ready),$(window).on("load",SinatraCoreDemoLibrary.load),SinatraCoreDemoLibrary.bindUIActions(),$(document).trigger("sinatraCoreReady")},ready:function(){},load:function(){SinatraCoreDemoLibrary.populateTemplates(sinatraCoreDemoLibrary.templates)},bindUIActions:function(){$document.on("click",".sinatra-demo .demo-screenshot, .sinatra-demo .preview",SinatraCoreDemoLibrary.preview),$document.on("click",".sinatra-demo .import",function(e){$(this).siblings(".preview").click(),$(".wp-full-overlay-main iframe").on("load",function(){$(".wp-full-overlay-header .sinatra-demo-import").trigger("click")})}),$document.on("click",".close-full-overlay",SinatraCoreDemoLibrary.closePreview),$document.keyup(function(e){27===e.keyCode&&$(".close-full-overlay").trigger("click")}),$document.on("click",".next-theme",SinatraCoreDemoLibrary.previewNext),$document.on("click",".previous-theme",SinatraCoreDemoLibrary.previewPrevious),$document.on("click",".devices button",SinatraCoreDemoLibrary.previewDevice),$document.on("click",".collapse-sidebar",SinatraCoreDemoLibrary.collapseSidebar),$document.on("click",".si-demo-section-title .control-toggle label",SinatraCoreDemoLibrary.collapsePreviewSection),$document.on("click",".sinatra-demo-import",SinatraCoreDemoLibrary.importDemo),$document.on("click","#import_content, #import_media",SinatraCoreDemoLibrary.importOptionsContent),$document.on("sinatra-core-import_started",SinatraCoreDemoLibrary.importStarted),$document.on("sinatra-core-install_plugins",SinatraCoreDemoLibrary.pluginsInstallActivate),$document.on("sinatra-core-import_customizer",SinatraCoreDemoLibrary.importCustomizer),$document.on("sinatra-core-import_content",SinatraCoreDemoLibrary.importContent),$document.on("sinatra-core-import_widgets",SinatraCoreDemoLibrary.importWidgets),$document.on("sinatra-core-import_options",SinatraCoreDemoLibrary.importOptions),$document.on("sinatra-core-import_wpforms",SinatraCoreDemoLibrary.importWPForms),$document.on("sinatra-core-import_completed",SinatraCoreDemoLibrary.importCompleted),$document.on("click",".demo-filters a",SinatraCoreDemoLibrary.filters),$document.on("input",".demo-search input",SinatraCoreDemoLibrary.search)},preview:function(event){event.preventDefault();$(this).parents(".sinatra-demo").data("demo-id");var self=$(this).parents(".sinatra-demo");self.addClass("sinatra-demo-previewed"),$html.addClass("sinatra-demo-preview-on"),SinatraCoreDemoLibrary.previewDemo(self)},previewDemo:function(anchor){var template=wp.template("sinatra-core-demo-preview"),data={id:anchor.data("demo-id"),pro:anchor.data("demo-pro"),url:anchor.data("demo-url"),screenshot:anchor.data("demo-screenshot"),name:anchor.data("demo-name"),description:anchor.data("demo-description"),slug:anchor.data("demo-slug"),required_plugins:anchor.data("required-plugins")};$(".theme-install-overlay").remove(),$(".sinatra-section.demos").append(template(data)),$(".theme-install-overlay").css("display","block"),SinatraCoreDemoLibrary.updateNextPrev(),$(".wp-full-overlay-main iframe").on("load",function(){$(".sinatra-demo-preview .sinatra-demo-import").removeAttr("disabled")})},updateNextPrev:function(){if($body.hasClass("importing"))$(".next-theme, .previous-theme").addClass("disabled");else{var current=$(".sinatra-demo-previewed").parent(),next=current.nextAll(".sinatra-column").length,prev=current.prevAll(".sinatra-column").length;0==next?$(".next-theme").addClass("disabled"):0!=next&&$(".next-theme").removeClass("disabled"),0==prev?$(".previous-theme").addClass("disabled"):0!=prev&&$(".previous-theme").removeClass("disabled")}},closePreview:function(event){event.preventDefault(),$("body").hasClass("importing")&&!confirm(sinatraCoreDemoLibrary.strings.closeWindowWarning)||($("body").removeClass("importing"),$(".previous-theme, .next-theme").removeClass("disabled"),$(".theme-install-overlay").css("display","none"),$(".theme-install-overlay").remove(),$(".sinatra-demo-previewed").removeClass("sinatra-demo-previewed"),$html.removeClass("sinatra-demo-preview-on"))},previewPrevious:function(event){event.preventDefault();var prev=$(".sinatra-demo-previewed").removeClass("sinatra-demo-previewed").parent().prev(".sinatra-column").find(".sinatra-demo").addClass("sinatra-demo-previewed");$(this).parents(".wp-full-overlay-header").data("demo-id");SinatraCoreDemoLibrary.previewDemo(prev)},previewNext:function(event){event.preventDefault();var next=$(".sinatra-demo-previewed").removeClass("sinatra-demo-previewed").parent().next(".sinatra-column").find(".sinatra-demo").addClass("sinatra-demo-previewed");$(this).parents(".wp-full-overlay-header").data("demo-id");SinatraCoreDemoLibrary.previewDemo(next)},previewDevice:function(event){var device=$(event.currentTarget).data("device");$(".theme-install-overlay").removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+device).data("current-preview-device",device),SinatraCoreDemoLibrary.previewDeviceButtons(device)},previewDeviceButtons:function(device){var $devices=$(".wp-full-overlay-footer .devices");$devices.find("button").removeClass("active").attr("aria-pressed",!1),$devices.find("button.preview-"+device).addClass("active").attr("aria-pressed",!0)},collapseSidebar:function(){event.preventDefault();var overlay=$(".wp-full-overlay");return overlay.hasClass("expanded")?(overlay.removeClass("expanded"),void overlay.addClass("collapsed")):overlay.hasClass("collapsed")?(overlay.removeClass("collapsed"),void overlay.addClass("expanded")):void 0},collapsePreviewSection:function(){var section_content=$(this).closest(".si-demo-section-title").next(".si-demo-section-content");$(this).prev('input[type="checkbox"]').is(":checked")?section_content.removeClass("hidden"):section_content.addClass("hidden")},importDemo:function(event){if(event.preventDefault(),!$("body").hasClass("importing")&&confirm(sinatraCoreDemoLibrary.strings.importDemoWarning)){new Date;SinatraCoreDemoLibrary.import_start_time=new Date,void 0!==$(this).attr("disabled")&&$(this).hasClass("disabled")||(SinatraCoreDemoLibrary.install_plugins=$(".plugin-list input:checked").not(":disabled").map(function(){return{slug:$(this).data("slug"),name:$(this).next(".si-label").html(),status:$(this).data("status")}}).get(),SinatraCoreDemoLibrary.import_steps=$(".si-demo-section-content.import-options input:checked").map(function(){if("import_media"!==$(this).attr("id"))return $(this).attr("id")}).get(),SinatraCoreDemoLibrary.install_plugins.length&&SinatraCoreDemoLibrary.import_steps.unshift("install_plugins"),SinatraCoreDemoLibrary.import_steps.includes("import_content")&&($("#install_plugin_wpforms-lite").is(":checked")&&SinatraCoreDemoLibrary.import_steps.splice(SinatraCoreDemoLibrary.import_steps.indexOf("import_content"),0,"import_wpforms"),SinatraCoreDemoLibrary.import_steps.push("import_options")),SinatraCoreDemoLibrary.import_steps.unshift("import_started"),SinatraCoreDemoLibrary.import_steps.push("import_completed"),$body.addClass("importing"),SinatraCoreDemoLibrary.updateNextPrev(),$(".si-checkbox input").attr("disabled","disabled"),$(".wp-full-overlay-header .sinatra-demo-import").text(sinatraCoreDemoLibrary.strings.importing),$document.trigger("sinatra-core-"+SinatraCoreDemoLibrary.import_steps[0]))}},pluginsInstallActivate:function(){SinatraCoreDemoLibrary.progress_delta=50/SinatraCoreDemoLibrary.import_steps.length/SinatraCoreDemoLibrary.install_plugins.length,SinatraCoreDemoLibrary.pluginInstall(SinatraCoreDemoLibrary.install_plugins[0])},pluginInstall:function(plugin){if($(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.installingPlugin+plugin.name),wp.updates.shouldRequestFilesystemCredentials&&!wp.updates.ajaxLocked&&(wp.updates.requestFilesystemCredentials(event),$(document).on("credential-modal-cancel",function(){wp.a11y.speak(wp.updates.l10n.updateCancel,"polite")})),"not_installed"===plugin.status)wp.updates.installPlugin({slug:plugin.slug,success:function(){SinatraCoreDemoLibrary.updateProgressBar(),$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.installed),SinatraCoreDemoLibrary.pluginActivate(plugin)},error:function(response){console.log(response)}});else if("installed"===plugin.status)SinatraCoreDemoLibrary.updateProgressBar(),$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.installed),SinatraCoreDemoLibrary.pluginActivate(plugin);else{if(SinatraCoreDemoLibrary.updateProgressBar(),$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.activated),SinatraCoreDemoLibrary.installed_plugins.push(SinatraCoreDemoLibrary.install_plugins.shift()),SinatraCoreDemoLibrary.install_plugins.length)return SinatraCoreDemoLibrary.pluginInstall(SinatraCoreDemoLibrary.install_plugins[0]);SinatraCoreDemoLibrary.importNextStep()}},pluginActivate:function(plugin){return $(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.activatingPlugin+plugin.name),$.ajax({url:sinatra_strings.ajaxurl,type:"POST",dataType:"json",data:{_ajax_nonce:sinatra_strings.wpnonce,action:"sinatra_core_import_step",import_step:"activate_plugin",plugin:plugin,demo_id:$(".wp-full-overlay-header").data("demo-slug")}}).then(function(data){if(SinatraCoreDemoLibrary.updateProgressBar(),$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.activated),SinatraCoreDemoLibrary.installed_plugins.push(SinatraCoreDemoLibrary.install_plugins.shift()),SinatraCoreDemoLibrary.install_plugins.length)return SinatraCoreDemoLibrary.pluginInstall(SinatraCoreDemoLibrary.install_plugins[0]);SinatraCoreDemoLibrary.importNextStep()})},importStepAJAX:function(data){return data._ajax_nonce=sinatra_strings.wpnonce,data.action="sinatra_core_import_step",data.demo_id=$(".wp-full-overlay-header").data("demo-slug"),$.ajax({url:sinatra_strings.ajaxurl,type:"POST",dataType:"json",data:data}).done(function(response){response.success?(SinatraCoreDemoLibrary.updateProgressBar(),SinatraCoreDemoLibrary.importNextStep()):console.log(response)}).fail(function(jqXHR,textStatus,errorThrown){console.log(jqXHR),console.log(textStatus),console.log(errorThrown)})},importStarted:function(){return SinatraCoreDemoLibrary.importStepAJAX({import_step:"import_started"})},importCustomizer:function(){$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.importingCustomizer);return SinatraCoreDemoLibrary.importStepAJAX({import_step:"import_customizer"})},importContent:function(){$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.importingContent);var data={import_step:"import_content",attachments:$("#import_media").is(":checked")?1:0};return SinatraCoreDemoLibrary.importStepAJAX(data)},importOptions:function(){$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.importingOptions);return SinatraCoreDemoLibrary.importStepAJAX({import_step:"import_options"})},importWPForms:function(){$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.importingWPForms);return SinatraCoreDemoLibrary.importStepAJAX({import_step:"import_wpforms"})},importWidgets:function(){$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.importingWidgets);return SinatraCoreDemoLibrary.importStepAJAX({import_step:"import_widgets"})},importCompleted:function(){SinatraCoreDemoLibrary.importStepAJAX({import_step:"import_completed"}),$(".wp-full-overlay-header .sinatra-demo-import").html(sinatraCoreDemoLibrary.strings.preview),$(".sinatra-demo-preview .sinatra-demo-import").removeClass("sinatra-demo-import").attr("href",sinatraCoreDemoLibrary.homeurl),$(".wp-full-overlay-footer .status").text(sinatraCoreDemoLibrary.strings.importCompleted),$body.removeClass("importing"),setTimeout(function(){$(".wp-full-overlay-footer .si-btn").addClass("animate")},100),setTimeout(function(){$(".wp-full-overlay-footer .si-btn").removeClass("animate")},3e3),SinatraCoreDemoLibrary.updateNextPrev()},importNextStep:function(){SinatraCoreDemoLibrary.import_steps.length?(SinatraCoreDemoLibrary.completed_steps.push(SinatraCoreDemoLibrary.import_steps.shift()),SinatraCoreDemoLibrary.updateProgressBar(),$document.trigger("sinatra-core-"+SinatraCoreDemoLibrary.import_steps[0])):$document.trigger("sinatra-core-import_completed")},updateProgressBar:function(){var delta=(100-SinatraCoreDemoLibrary.progress)/SinatraCoreDemoLibrary.import_steps.length;0<SinatraCoreDemoLibrary.install_plugins.length&&(delta/=2,delta/=SinatraCoreDemoLibrary.install_plugins.length),SinatraCoreDemoLibrary.progress+=delta,$("#si-progress-bar .si-progress-percentage").css("width",SinatraCoreDemoLibrary.progress+"%")},importOptionsContent:function(){var $checkbox=$(this);"import_content"===$checkbox.attr("id")&&($checkbox.is(":checked")?$("#import_media").removeAttr("disabled","disabled"):$("#import_media").attr("disabled","disabled").removeAttr("checked")),"import_media"===$checkbox.attr("id")&&$checkbox.is(":checked")&&$("#import_content").attr("checked","checked")},populateTemplates:function(templates){if($(".sinatra-section.demos").html(""),_.isEmpty(templates))$(".sinatra-section.demos").html('<div class="sinatra-column">'+sinatraCoreDemoLibrary.strings.noResultsFound+"</div>");else{var data,demo_template=wp.template("sinatra-core-demo-item");for(var key in templates)data={id:key,pro:templates[key].pro,url:templates[key].url,screenshot:templates[key].screenshot,name:templates[key].name,description:templates[key].description,slug:templates[key].slug,required_plugins:templates[key].plugins},$(".sinatra-section.demos").append(demo_template(data))}},filters:function(e){e.preventDefault();var $this=$(this);$this.closest("ul").find("li").removeClass("selected"),$this.closest("li").addClass("selected"),SinatraCoreDemoLibrary.filterDemoList()},search:function(){var $this=$(this),timer=0;timer&&clearTimeout(timer);var search_input=$this.val();(!search_input||search_input&&4<=search_input.length)&&(timer=setTimeout(function(){SinatraCoreDemoLibrary.filterDemoList()},300))},filterDemoList:function(){var filters={category:$(".demo-filters .demo-categories li.selected a").data("category"),builder:$(".demo-filters .demo-builders li.selected a").data("builder"),s:$(".demo-search input").val()};return $.ajax({url:sinatra_strings.ajaxurl,type:"POST",dataType:"json",data:{_ajax_nonce:sinatra_strings.wpnonce,action:"sinatra-core-filter-demos",filters:filters}}).then(function(response){response.success&&SinatraCoreDemoLibrary.populateTemplates(response.data)})}};SinatraCoreDemoLibrary.init(),window.SinatraCoreDemoLibrary=SinatraCoreDemoLibrary}(jQuery);